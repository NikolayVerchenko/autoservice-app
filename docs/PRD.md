# PRD: Система управления автосервисом

## Цель системы
Создать единую цифровую систему для ведения диагностики, согласования и исполнения работ автосервиса: от первичной фиксации жалоб клиента до формирования заказ-наряда и печатных документов. Система должна обеспечить прозрачность статусов, фиксацию ответственности по ролям, снижение потерь информации и ускорение цикла обслуживания.

## Роли

### Мастер-приемщик
- Регистрирует обращение клиента и создает дефектовку.
- Фиксирует жалобы клиента в структурированном виде.
- Назначает дефектовку механику.
- Контролирует прохождение этапов диагностики, проценки и согласования.
- Переносит согласованные позиции в заказ-наряд.

### Механик
- Получает назначенные дефектовки.
- Проводит диагностику по каждой жалобе отдельно.
- Формирует ответ по каждой жалобе, прикладывает фото/видео.
- Указывает необходимые работы и запчасти по каждой жалобе.
- Формирует итог по каждой жалобе с признаком «Согласовано» или «В рекомендации».

### Менеджер по запчастям
- Выполняет проценку запчастей, предложенных в дефектовке.
- Уточняет наличие, сроки поставки и стоимость.
- Передает данные для этапа согласования.
- Обеспечивает корректность запчастей при переносе в заказ-наряд.

## Центральная сущность: Дефектовка
Дефектовка — ключевой документ диагностики, который связывает жалобы клиента, результаты проверки, перечни работ и запчастей, а также итоговые решения по каждой жалобе. Все дальнейшие действия (согласование, перенос в заказ-наряд, печать, отправка клиенту) строятся на основе дефектовки.

## Структура дефектовки

### Жалобы
- Одна дефектовка содержит несколько жалоб.
- Каждая жалоба является самостоятельной единицей обработки.

### Ответ механика на каждую жалобу
- Для каждой жалобы фиксируется отдельный ответ механика.
- Ответ содержит диагностику, выводы и обоснование.

### Фото/видео
- Для каждой жалобы могут быть приложены фото и/или видео материалы.
- Медиафайлы используются как доказательная база для согласования с клиентом.

### Работы по жалобе
- Для каждой жалобы указывается перечень необходимых работ.
- По каждой работе фиксируются наименование, количество, стоимость и итоговая сумма.

### Запчасти по жалобе
- Для каждой жалобы указывается перечень необходимых запчастей.
- По каждой запчасти фиксируются наименование, количество, стоимость и итоговая сумма.

### Итог по жалобе
- Для каждой жалобы формируется итоговое заключение.
- Итог содержит краткий результат диагностики, перечень действий и итоговую сумму.

### Согласовано / В рекомендации
- Каждая жалоба имеет отдельный статус результата:
  - **Согласовано**: позиция одобрена клиентом к исполнению.
  - **В рекомендации**: предложено к исполнению, но не согласовано в текущем заказе.

## Процесс

### Создание дефектовки
- Мастер-приемщик создает дефектовку и вносит жалобы клиента.
- Система присваивает документу уникальный идентификатор и стартовый статус.

### Назначение механику (Telegram)
- Мастер-приемщик назначает дефектовку конкретному механику.
- Механику отправляется уведомление в Telegram с переходом к назначенной дефектовке.

### Диагностика
- Механик обрабатывает жалобы поштучно.
- Для каждой жалобы заполняет ответ, прикладывает медиа, указывает работы и запчасти.

### Проценка
- Менеджер по запчастям оценивает стоимость и доступность запчастей.
- Данные проценки фиксируются в дефектовке и доступны для согласования.

### Согласование
- Клиент получает дефектовку и согласовывает позиции.
- Решение фиксируется по каждой жалобе отдельно: «Согласовано» или «В рекомендации».

### Перенос в заказ-наряд
- Согласованные позиции автоматически или полуавтоматически переносятся в заказ-наряд.
- Рекомендованные позиции сохраняются в отдельном блоке рекомендаций.

## Заказ-наряд

### Работы
- Содержит согласованный перечень работ из дефектовки.

### Запчасти
- Содержит согласованный перечень запчастей из дефектовки.

### Рекомендации
- Содержит позиции из дефектовки со статусом «В рекомендации».
- Рекомендации не включаются в обязательный объем текущего исполнения.

## Telegram
- Механик отвечает по каждой жалобе отдельно.
- Клиент привязывается к обращению через deep-link.
- Клиент получает дефектовку в цифровом виде и PDF-документ.

## Деньги
- Валюта системы: российский рубль.
- Денежные значения хранятся как целые числа.
- Копейки не используются.

## Печатные формы
- Формат: A4.
- Поддержка многостраничных документов.
- Должна обеспечиваться корректная пагинация и читабельная структура при печати.

## Планировщик / Запись на сервис
- Мастер-приемщик может создать запись на дату и время (начало/конец) для клиента и автомобиля.
- Запись может быть привязана к существующей дефектовке (`Defect`) или создана как предварительная запись с последующим созданием дефектовки.
- Статусы записи: `PLANNED`, `CONFIRMED`, `ARRIVED`, `CANCELED`, `DONE`.
- Во фронтенде требуется простой недельный/дневной вид; для MVP допустима реализация в формате таблицы/списка.
- Нужны напоминания клиенту в Telegram (опционально, на последующем этапе).
- В рамках MVP поддерживается один сервис и одна локация.
